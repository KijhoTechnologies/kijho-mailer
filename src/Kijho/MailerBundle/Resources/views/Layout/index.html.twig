{% extends 'KijhoMailerBundle:Default:main.html.twig' %}
{% block title %}Layouts{% endblock %}
{% block main_content %}
    <h2 class="pull-left">Layouts</h2>
    <div class="btn-group pull-right top-margin" role="group" aria-label="...">
        <a href="{{path('kijho_mailer_layout_new')}}" class="btn btn-default">New Layout</a>
    </div>
    <ol class="col-lg-12 breadcrumb">
        <li><a href="{{path('kijho_mailer_homepage')}}">Home</a></li>
        <li class="active">Layouts</li>
    </ol>

    {{ macros.showSuccessMessage('messageSuccessLayout')}}  

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Name</th>
                <th>Creation Date</th>
                <th>Language</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody>
            {% for layout in layouts %}
                <tr>
                    <td>{{layout.name}}</td>
                    <td>{{layout.creationDate|date('m/d/Y')}}</td>
                    <td>{{layout.languageCode}}</td>
                    <td>
                        <a href='{{path('kijho_mailer_layout_preview',{'layoutId':layout.id})}}'><i class="fa fa-eye fa-lg">Preview</i></a>
                        &nbsp;<a href='{{path('kijho_mailer_layout_edit',{'layoutId':layout.id})}}' title="Edit"><i class="fa fa-pencil fa-lg">Edit</i></a>
                        &nbsp;<a href='javascript:' title="Delete" class="delete-layout" layout-id="{{layout.id}}"><i class="fa fa-close fa-lg">Delete</i></a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">No layouts.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block scripts %}
    $(".delete-layout").click(function () {
        var object = $(this);
        var layoutId = object.attr('layout-id');

        bootbox.confirm('Are you sure you want to delete this layout ?', function (result) {

            if (result == true)
            {
                $.ajax({
                    type: 'POST',
                    url: "{{ path('kijho_mailer_layout_delete')}}",
                    dataType: 'json',
                    data: 'layoutId=' + layoutId,
                    success: function (resp) {
                        console.log(resp);
                        if (resp.result == '__OK__') {
                            object.parent().parent().remove();
                        } else {
                            bootbox.alert(resp.msg);
                        }
                    },
                    error: function () {
                        bootbox.alert('Error, try again')
                    }
                });
            }
        });
    });
{% endblock %}
